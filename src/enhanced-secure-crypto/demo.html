<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Secure Crypto Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .status-panel {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .status-ready { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .status-loading { background-color: #fff3cd; border: 1px solid #ffeaa7; }
        .status-error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .section {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        textarea, input { padding: 8px; border-radius: 3px; border: 1px solid #ccc; }
        .encrypted-box { background-color: #f8f9fa; font-family: monospace; font-size: 12px; }
        .success-box { background-color: #d4edda; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ğŸ” Enhanced Secure Crypto Demo (Rust + WASM)</h1>
    
    <div id="status" class="status-panel status-loading">
        <h3>Status</h3>
        <p id="status-text">Initializing...</p>
        <p id="crypto-ready">Crypto Ready: â³ Loading...</p>
    </div>

    <div id="demo-content" style="display: none;">
        <!-- Password Section -->
        <div class="section">
            <h3>ğŸ”‘ Password Management</h3>
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <input type="text" id="password" placeholder="Encryption password" style="flex: 1;">
                <button onclick="generateNewPassword()">Generate New</button>
            </div>
            <button onclick="generateVerificationCode()">Generate Verification Code</button>
        </div>

        <!-- Message Section -->
        <div class="section">
            <h3>ğŸ’¬ Message Operations</h3>
            <textarea id="message" placeholder="Enter your message here..." rows="4" style="width: 100%; margin-bottom: 10px;">Hello, secure world! ğŸ”</textarea>
            <div>
                <button onclick="encryptMessage()">ğŸ”’ Encrypt</button>
                <button onclick="signMessage()">âœï¸ Sign</button>
                <button onclick="verifySignature()">ğŸ” Verify Signature</button>
            </div>
        </div>

        <!-- Encrypted Message Section -->
        <div id="encrypted-section" class="section" style="display: none;">
            <h3>ğŸ” Encrypted Message</h3>
            <textarea id="encrypted-message" readonly rows="4" style="width: 100%; margin-bottom: 10px;" class="encrypted-box"></textarea>
            <button onclick="decryptMessage()">ğŸ”“ Decrypt</button>
        </div>

        <!-- Decrypted Message Section -->
        <div id="decrypted-section" class="section" style="display: none;">
            <h3>ğŸ“„ Decrypted Message</h3>
            <div id="decrypted-message" class="success-box"></div>
        </div>

        <!-- Signature Section -->
        <div id="signature-section" class="section" style="display: none;">
            <h3>âœï¸ Digital Signature</h3>
            <textarea id="signature" readonly rows="2" style="width: 100%;" class="encrypted-box"></textarea>
        </div>

        <!-- Security Info -->
        <div class="section" style="background-color: #d1ecf1; border-color: #bee5eb;">
            <h3>ğŸ›¡ï¸ Security Information</h3>
            <ul>
                <li><strong>Encryption:</strong> AES-256-GCM (256-bit key)</li>
                <li><strong>Key Derivation:</strong> PBKDF2-HMAC-SHA256 (100,000 iterations)</li>
                <li><strong>Digital Signatures:</strong> ECDSA P-384 with SHA-384</li>
                <li><strong>Random Generation:</strong> Cryptographically secure PRNG</li>
                <li><strong>Memory Safety:</strong> Rust + WebAssembly</li>
                <li><strong>Performance:</strong> ~5-7x faster than pure JavaScript</li>
            </ul>
        </div>
    </div>

    <!-- Ğ’ĞĞ–ĞĞ: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ type="module" Ğ´Ğ»Ñ ES6 Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ² -->
    <script type="module">
        // Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ WASM Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ĞºĞ°Ğº ES6 Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
        import init, { EnhancedSecureCryptoUtils } from './pkg/enhanced_secure_crypto.js';

        let crypto = null;
        let keyPair = null;
        let isReady = false;

        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
        function updateStatus(text, type = 'loading') {
            document.getElementById('status-text').textContent = text;
            document.getElementById('status').className = `status-panel status-${type}`;
        }

        function updateCryptoReady(ready) {
            document.getElementById('crypto-ready').textContent = `Crypto Ready: ${ready ? 'âœ… Yes' : 'â³ Loading...'}`;
            document.getElementById('demo-content').style.display = ready ? 'block' : 'none';
        }

        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ WASM Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        async function initializeCrypto() {
            try {
                updateStatus('Loading WASM module...', 'loading');
                
                // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ WASM
                await init();
                
                updateStatus('Creating crypto instance...', 'loading');
                
                // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€
                crypto = new EnhancedSecureCryptoUtils();
                
                updateStatus('Generating secure password...', 'loading');
                const password = crypto.generate_secure_password();
                document.getElementById('password').value = password;
                
                updateStatus('Generating key pair...', 'loading');
                keyPair = crypto.generate_ecdsa_keypair();
                
                isReady = true;
                updateStatus('âœ… Rust crypto module ready!', 'ready');
                updateCryptoReady(true);
                
            } catch (error) {
                console.error('Crypto initialization failed:', error);
                updateStatus(`âŒ Failed: ${error.message}`, 'error');
                updateCryptoReady(false);
            }
        }

        // Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ (Ğ´ĞµĞ»Ğ°ĞµĞ¼ Ğ¸Ñ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¼Ğ¸ Ğ¸Ğ· HTML)
        window.generateNewPassword = function() {
            if (!crypto) return;
            const newPassword = crypto.generate_secure_password();
            document.getElementById('password').value = newPassword;
            updateStatus('ğŸ”‘ New password generated', 'ready');
        };

        window.generateVerificationCode = function() {
            if (!crypto) return;
            const code = crypto.generate_verification_code();
            updateStatus(`ğŸ”¢ Verification code: ${code}`, 'ready');
        };

        window.encryptMessage = function() {
            if (!crypto) return;
            
            const message = document.getElementById('message').value;
            const password = document.getElementById('password').value;
            
            if (!message.trim()) {
                updateStatus('âŒ Please enter a message', 'error');
                return;
            }

            try {
                updateStatus('ğŸ”’ Encrypting message...', 'loading');
                const sanitized = crypto.sanitize_message(message);
                const encrypted = crypto.encrypt_data(sanitized, password);
                
                document.getElementById('encrypted-message').value = encrypted;
                document.getElementById('encrypted-section').style.display = 'block';
                updateStatus('âœ… Message encrypted successfully', 'ready');
            } catch (error) {
                updateStatus(`âŒ Encryption failed: ${error.message}`, 'error');
            }
        };

        window.decryptMessage = function() {
            if (!crypto) return;
            
            const encryptedMessage = document.getElementById('encrypted-message').value;
            const password = document.getElementById('password').value;
            
            if (!encryptedMessage.trim()) {
                updateStatus('âŒ No encrypted message to decrypt', 'error');
                return;
            }

            try {
                updateStatus('ğŸ”“ Decrypting message...', 'loading');
                const decrypted = crypto.decrypt_data(encryptedMessage, password);
                
                document.getElementById('decrypted-message').textContent = decrypted;
                document.getElementById('decrypted-section').style.display = 'block';
                updateStatus('âœ… Message decrypted successfully', 'ready');
            } catch (error) {
                updateStatus(`âŒ Decryption failed: ${error.message}`, 'error');
            }
        };

        window.signMessage = function() {
            if (!crypto || !keyPair) return;
            
            const message = document.getElementById('message').value;
            
            if (!message.trim()) {
                updateStatus('âŒ Please enter a message to sign', 'error');
                return;
            }

            try {
                updateStatus('âœï¸ Signing message...', 'loading');
                const signatureBytes = crypto.sign_data(keyPair.private_key, message);
                const signatureHex = Array.from(signatureBytes)
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
                
                document.getElementById('signature').value = signatureHex;
                document.getElementById('signature-section').style.display = 'block';
                updateStatus('âœ… Message signed successfully', 'ready');
            } catch (error) {
                updateStatus(`âŒ Signing failed: ${error.message}`, 'error');
            }
        };

        window.verifySignature = function() {
            if (!crypto || !keyPair) return;
            
            const message = document.getElementById('message').value;
            const signatureHex = document.getElementById('signature').value;
            
            if (!message.trim() || !signatureHex.trim()) {
                updateStatus('âŒ Need message and signature to verify', 'error');
                return;
            }

            try {
                updateStatus('ğŸ” Verifying signature...', 'loading');
                const signatureBytes = signatureHex.match(/.{1,2}/g).map(byte => parseInt(byte, 16));
                const isValid = crypto.verify_signature(keyPair.public_key, signatureBytes, message);
                updateStatus(isValid ? 'âœ… Signature is valid' : 'âŒ Signature is invalid', isValid ? 'ready' : 'error');
            } catch (error) {
                updateStatus(`âŒ Verification failed: ${error.message}`, 'error');
            }
        };

        // Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
        initializeCrypto();
    </script>
</body>
</html>